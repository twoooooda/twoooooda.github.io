(()=>{var g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","\u2026":"&hellip;"};function m(a){return g[a]||a}function w(a){return a.replace(/[&<>"]/g,m)}function T(a){return a.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}var o=class a{data;form;input;list;resultTitle;resultTitleTemplate;constructor({form:e,input:r,list:i,resultTitle:n,resultTitleTemplate:t}){this.form=e,this.input=r,this.list=i,this.resultTitle=n,this.resultTitleTemplate=t,this.handleQueryString(),this.bindQueryStringChange(),this.bindSearchForm()}async searchKeywords(e){let r=await this.getData(),i=[];e.sort((n,t)=>t.length-n.length);for(let n of r){let t={...n,preview:"",matchCount:0},p=!1;for(let u of e){if(u==="")continue;let s=new RegExp(T(w(u)),"gi"),c=s.exec(t.content);s.lastIndex=0;let h=s.exec(t.title);if(s.lastIndex=0,h&&(t.title=t.title.replace(s,a.marker)),h||c){p=!0,++t.matchCount;let l=0,d=100;c&&(l=c.index-20,d=c.index+80,l<0&&(l=0)),t.preview.indexOf(u)!==-1?t.preview=t.preview.replace(s,a.marker):(l!==0&&(t.preview+="[...] "),t.preview+=`${t.content.slice(l,d).replace(s,a.marker)} `)}}p&&(t.preview+="[...]",i.push(t))}return i.sort((n,t)=>t.matchCount-n.matchCount)}static marker(e){return"<mark>"+e+"</mark>"}async doSearch(e){let r=performance.now(),i=await this.searchKeywords(e);this.clear();for(let t of i)this.list.append(a.render(t));let n=performance.now();this.resultTitle.innerText=this.generateResultTitle(i.length,((n-r)/1e3).toPrecision(1))}generateResultTitle(e,r){return this.resultTitleTemplate.replace("#PAGES_COUNT",e).replace("#TIME_SECONDS",r)}async getData(){if(!this.data){let e=this.form.dataset.json;this.data=await fetch(e).then(r=>r.json())}return this.data}bindSearchForm(){let e="",r=i=>{i.preventDefault();let n=this.input.value;if(a.updateQueryString(n,!0),n==="")return this.clear();e!==n&&(e=n,this.doSearch(n.split(" ")))};this.input.addEventListener("input",r),this.input.addEventListener("compositionend",r)}clear(){this.list.innerHTML="",this.resultTitle.innerText=""}bindQueryStringChange(){window.addEventListener("popstate",e=>{this.handleQueryString()})}handleQueryString(){let r=new URL(window.location.toString()).searchParams.get("keyword");this.input.value=r,r?this.doSearch(r.split(" ")):this.clear()}static updateQueryString(e,r=!1){let i=new URL(window.location.toString());e===""?i.searchParams.delete("keyword"):i.searchParams.set("keyword",e),r?window.history.replaceState("","",i.toString()):window.history.pushState("","",i.toString())}static render(e){return createElement("article",null,createElement("a",{href:e.permalink},createElement("div",{class:"article-details"},createElement("h2",{class:"article-title",dangerouslySetInnerHTML:{__html:e.title}}),createElement("secion",{class:"article-preview",dangerouslySetInnerHTML:{__html:e.preview}})),e.image&&createElement("div",{class:"article-image"},createElement("img",{src:e.image,loading:"lazy"}))))}};window.addEventListener("load",()=>{setTimeout(function(){let a=document.querySelector(".search-form"),e=a.querySelector("input"),r=document.querySelector(".search-result--list"),i=document.querySelector(".search-result--title");new o({form:a,input:e,list:r,resultTitle:i,resultTitleTemplate:window.searchResultTitleTemplate})},0)});var f=o;})();
